# DX4MGR Ver11 シナリオパラメータ解説ガイド

DX4MGR Ver11 (並列実験プラットフォームモデル) で使用される各パラメータの意味、システム上の挙動、および設定の際のヒントを解説します。
本ガイドは `scenarios.csv` の項目に基づいています。

---

## 1. 基本設定 (Base Parameters)

- **scenario_name**: シナリオの識別名。
- **n_trials**: モンテカルロ・シミュレーションの試行回数。
  - 推奨: 20〜100回。統計的な有意差を確認したい場合は 100回以上を推奨。
- **days**: シミュレーションを実行する期間（日）。
  - 通常は 365 (1年) を設定します。

※ **sampling_interval**: シミュレーション中に WIP（仕掛り案件数）を記録する時間間隔。
  - **注意**: これは `scenarios.csv` には含まれず、実行スクリプト (`run.py` 等) で一括設定される共通パラメータです。

---

## 2. 案件投入と工程 (Flow & Duration)

- **arrival_rate**: 1日あたりの平均案件投入数。
  - 0.5 の場合、平均して 2日に 1件のペースで新しい案件が「小実験」工程に投入されます。
- **small_exp_duration**: 「小実験」工程にかかる平均日数。
  - 指数分布に従ってサンプリングされます。
- **proto_duration**: 「試作・テスト」工程にかかる平均日数。
  - 試作ラインはリソースが有限（後述の `n_servers_proto` で指定）であるため、期間が長いとここで待ち時間が発生します。

---

## 3. 摩擦と並列化 (Friction & Scaling)

人数を増やすことによる副作用（コミュニケーションコストの増大）を表現するパラメータです。

- **n_servers_proto**: 「試作・テスト」工程に従事するオペレーターの人数（並列処理能力）。
- **friction_model**: 摩擦（コミュニケーションロス）の計算モデル。
  - `linear`: 線形モデル。 $1 + \alpha \times (n - 1)$
  - `pairs`: ペア数モデル。 $1 + \alpha \times \frac{n(n-1)}{2}$
- **friction_alpha**: 摩擦の強度係数 ($\alpha$)。
  - 0.05〜0.1 程度を設定します。
  - **重要**: $\alpha > 0$ のとき、`n_servers_proto` を増やしても、ある時点からコミュニケーションコストが並列化のメリットを上回り、リードタイムが悪化し始めます。

---

## 4. 審査と意思決定 (Gate & Decision)

- **bundle_size**: DR（デザインレビュー）にかける案件のまとめ単位。
  - 3 の場合、3つの案件が揃うまで DR 待ちとなります。
- **dr_period**: DR（審査）が開催される周期（日）。
- dr_periods: 例 `30|65` で多段DRを指定（空なら dr_period を使用）
  - 多段DR時の差し戻し（CONDITIONAL）は、**直前のDRゲート**まで戻ります（最初のDRのみSMALL_EXPへ戻る）。
  - 90 の場合、四半期に一度のペースで DR が開催されます。
- **decision_latency_days**: DR 終了後から正式な意思決定が下るまでのタイムラグ。
  - 実務上の「決裁待ち」を表現します。

---

## 5. 要員構成 (Resources)

要員構成を以下の 3つの役割の人数で指定します。これらに基づき、DR の審査能力（キャパシティ）と品質（合格率）が自動計算されます。

- **n_senior**: シニア層（熟練者）の人数。 (能力: 10, 品質: 0.95)
- **n_coordinator**: コーディネーター層の人数。 (能力: 5, 品質: 0.8)
- **n_new**: 新人・若手層の人数。 (能力: 2, 品質: 0.6)

※ **dr_capacity / dr_quality**:
  - `scenarios.csv` には項目として存在しますが、Ver11 では上記の要員構成から自動計算されるため、**ここに入力された値は無視されます**。過去バージョンとの互換性のために残されています。

---

## 6. 手戻りと増殖 (Rework & Complexity)

DR で否認（または条件付き合格）された際、案件は「小実験」工程に差し戻されます。Ver11 ではこれを「タスクの増殖」として表現します。

- **rework_load_factor**: 差し戻し時の「増殖率」の係数。
  - 1.0 の場合、サンプリングされた重みに応じた数の新しいタスクが生成されます。
- **max_rework_cycles**: 最大差し戻し回数。これを超えるとタスク増殖は止まります。
- **decay**: 差し戻しを繰り返す際の負荷減衰率。
- **rework_beta_a / rework_beta_b**: 差し戻し時の負荷（重み）を決定するベータ分布の形状パラメータ。
- **conditional_prob_ratio**: 条件付き合格の比率。
  - 品質チェックにパスしなかった案件のうち、どれくらいの割合を「完全に否認（NO GO）」せずに「修正を条件に差し戻し（CONDITIONAL）」とするかを決定します。
  - 値を大きくすると、救済（差し戻し）が増え、完全に捨てられる案件が減ります。

※ **rework_task_type_mix**:
  - `scenarios.csv` には存在しますが、現バージョンでは**未使用**です。将来的に「小実験」と「試作」の増殖比率を調整するために予約されています。

---

## 分析のヒント

1. **ボトルネックの特定**: `gate_wait_heatmap.png` を見て、どの工程で待ち時間が長いかを確認してください。`DR_GATE` での待ちが長い場合は `dr_period` の短縮や `bundle_size` の見直しが有効です。
2. **リソース最適化**: 全員シニアにするよりも、適切な数のコーディネーターを配置した方が、コストパフォーマンス（スループット/人数）が良い場合があります。
3. **レジリエンスの検証**: `rework_load_factor` を上げた際の性能劣化が激しいシナリオは、手戻りに弱いプロセスと言えます。
