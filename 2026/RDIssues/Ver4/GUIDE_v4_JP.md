# DX4MGR Ver4: 内部構造と設計思想ガイド

このドキュメントでは、本シミュレータの背後にある論理構造と、なぜこの計算モデルを採用しているのかについて技術的・組織論的な観点から解説します。

---

## 1. コア・ロジック：待ち行列理論 (Queueing Theory)

本シミュレータは、組織の意思決定プロセスを「ジョブ（案件）がサーバ（承認者）に到着し、処理される」という **M/M/c 待ち行列モデル** をベースに構築しています。

### なぜ待ち行列なのか？
- **非線形な爆発**: 稼働率が1.0（100%）に近づくと、待ち時間は線形ではなく指数関数的に増大します。これが「現場が急に回らなくなる」メカニズムです。
- **ばらつきの考慮**: 案件の到着間隔や処理時間は一定ではありません。この「ゆらぎ」が重なることで、平均値では見えない「詰まり」が発生します。

---

## 2. 組織のオーバーヘッド：依存関係モデル

単なる待ち行列に加えて、DX4MGRでは以下の数式を用いて組織構造の影響をモデル化しています。

### 実効処理能力の計算式
$$EffectiveServiceRate = BaseServiceRate \times SkillFactor \times CoordinationFactor$$

ここで、`CoordinationFactor` は以下の式で算出されます：
$$CoordinationFactor = \frac{1}{1 + CoordinationPenalty \times AdjustedDependency}$$

### 設計の意図
- **スキルの相殺**: 個人のスキルを上げても（SkillFactor）、組織間の依存関係が複雑な場合（AdjustedDependency）、その効果は CoordinationFactor によって相殺されます。「優秀な人が多いのに進みが遅い」組織の再現です。
- **調整コストの可視化**: 依存関係（Dependency）が増えると、調整コストは指数関数的に増大するという Conwayの法則的な挙動をモデルに組み込んでいます。

---

## 3. 品質と手戻り：再作業ループ (Rework Loop)

承認プロセスは単なる通過点ではなく、品質の検査点でもあります。

- **確率的再作業**: `p_rework` の確率で、案件は完了せず「待ち行列の先頭」に差し戻されます。
- **隠れた負荷**: 再作業が発生すると、それは「新しい案件」と同じように承認者のキャパシティを消費します。これにより、見かけ上の到着率以上にシステム全体の負荷が高まります。

---

## 4. なぜ「P90」を重視するのか？

上層部への説明において「平均待ち時間」は非常に危険です。

- **尾っぽの恐怖**: 待ち行列システムでは、平均値は低くても「特定の1割の案件が極端に遅れる」現象（ロングテール）が頻発します。
- **信頼の毀損**: 現場の炎上や顧客の不満は、平均ではなくこの「最悪ケース（P90/P95）」によって引き起こされます。
- **保証可能な納期**: P90（90%の確率でこの日までに終わる）を示すことで、単なる希望的観測ではない「守れる納期」の議論が可能になります。

---

## 6. プログラム構成と役割

- **`scenarios.csv`**: 意思決定の「入力データ」。組織の現状や改善案を数値で定義します。
- **`simulator_v4.py`**: 数理モデルの実装。CSVから読み込まれたパラメータに基づき、仮想の業務フローを走らせます。
- **`visualizer_v4.py`**: データの「翻訳」。複雑なシミュレーション結果を、上層部が直感的に理解できるグラフ（バイオリン図、サバイバル曲線など）に変換します。
- **`run_v4.py`**: 全体のコントローラー。CSVを読み込み、シミュレータを回し、可視化を実行する一連のフローを自動化します。

---

## 7. 発展的な活用案

- **感度分析の深化**: `scenarios.csv` に特定のパラメータ（例：`p_rework`）だけを少しずつ変えた行を複数作ることで、どの程度の改善で「破綻」を免れるかの境界線を特定できます。
- **複数プロジェクトの比較**: プロジェクトごとにCSVファイルを作成することで、組織全体のボトルネックがどこにあるかを統一基準で比較できます。
